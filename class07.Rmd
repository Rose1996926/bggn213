---
title: "Class 7: R functions and packages"
author: "Rose Li"
date: "4/24/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## More on function writing

First we well revisit our function from last day 
```{r}
source("http://tinyurl.com/rescale-R")
```

Test the **rescale()** function
```{r}
rescale(1:10)
```

```{r}
x <- c(1:10, "string")
!is.numeric(x)
```

```{r}
#rescale2(x)
```

## Function Practice

White a function to identify NA elements in two vectors

Start with a simple example input where I know what the answer should be 
```{r}
x <- c( 1, 2, NA, 3, NA)
y <- c(NA, 3, NA, 3, 4)
```

```{r}
is.na(x)
```

```{r}
is.na(y)
```

```{r}
is.na(x) & is.na(y)
```

```{r}
which (is.na(x) & is.na(y))
```

```{r}
sum(is.na(x) & is.na(y))
```

This is my working snippet of code that I can use as the body of my first function!
```{r}
both_na <- function(x,y) {
  sum(is.na(x) & is.na(y))
}
```

```{r}
both_na (x,y)
```

```{r}
both_na (c(NA,NA,NA), c(NA,NA,1))
```
If the length of the vector is not the same, R is going to recycle the number in the vetor
```{r}
both_na(c(NA,NA,NA), c(1,NA,NA,NA))
```

```{r}
both_na(c(NA,NA,NA), c(1,NA,NA,NA,NA,NA))
```

Check the length of our inputs are equal 
```{r}
x <- c(NA,NA,NA)
y <- c(1,NA,NA,NA,NA,NA)
length(x) != length(y)
```

Try the both_na3() function with extra features
```{r}
x <- c( 1, 2, NA, 3, NA)
y <- c(NA, 3, NA, 3, 4)
both_na3(x, y)
```
```{r}
which(c(F,T, F, F,T))
```

## Practice example grade function 
```{r}
#student1
#c(100, 100, 100, 100, 100, 100, 100, 90)
```

```{r}
#student2
#c(100, NA, 90, 90, 90, 90, 97, 80)
```


```{r}
x1 <- c(100, 100, 100, 100, 100, 100, 100, 90)
min(x1)
x1[which(x1 != min(x1))]

(sum(x)-min(x))/(length(x)-1)
```

I got my snippet, now to turn it into my first version of the grade() function

```{r}
grade <- function(x) {
  (sum(x)-min(x))/(length(x)-1)
}
```

```{r}
grade(x1)
```
```{r}
x2 <- c(100, NA, 90, 90, 90, 90, 97, 80)
grade(x2)
```
```{r}
grade <- function(x) {
  (sum(x, na.rm=TRUE)-min(x, na.rm=TRUE))/(length(x)-1)
}
grade(x2)
```


```{r}
url <- "https://tinyurl.com/gradeinput"

students <- read.csv(url, row.names=1)
head(students)
```



```{r}
apply(students, 1, grade)
ans <- apply(students, 1, grade)
```

```{r}
sort(ans)
```


```{r}
sort(ans, decreasing = TRUE)
```

## One last function example

Find the intersection of two sets 
```{r}
x <- df1$IDs
y <- df2$IDs

intersect(x, y)
```
```{r}
x
y
x %in% y
x[x %in% y]
```

```{r}
y %in% x
```
```{r}
cbind(x [x %in% y],
y [y %in% x])
```
 
 Code-->Extract Function
```{r}
gene_intersect <- function(x, y) {
  cbind(x [x %in% y],
  y [y %in% x])
}
```

```{r}
gene_intersect2 <- function(df1, df2) { cbind( df1[ df1$IDs %in% df2$IDs, ],
df2[ df2$IDs %in% df1$IDs, "exp"] )
}
```

```{r}
gene_intersect3 <- function(df1, df2, gene.colname="IDs") {
cbind( df1[ df1[,gene.colname] %in% 
            df2[,gene.colname], ],
  exp2=df2[ df2[,gene.colname] %in% 
            df1[,gene.colname], "exp"] )
}

```

```{r}
merge(df1, df2, by="IDs")
```



